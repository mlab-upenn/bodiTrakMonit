<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>FSACLibrary: FSA C Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">FSACLibrary
   &#160;<span id="projectnumber">1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">FSA C Library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="overviewSection"></a>
Overview</h1>
<p>The FSA C library contains a collection C functions that can be used to get calibrated readings from an FSA T7 sensor array. The library is contained in the file called fsa.lib (libfsa.a on Linux) and can be statically linked into an executable.</p>
<h1><a class="anchor" id="startedSection"></a>
Getting Started</h1>
<p>To illustrate how to use this library here is a simple example that creates an FSAT7 object, takes a reading, and processes the results.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;fsa.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> main() {</div>
<div class="line">        FSAT7 t7;</div>
<div class="line">        fsat7Initialize();</div>
<div class="line">        t7 = <a class="code" href="group__fsat7.html#ga53b517f891e779676eeb26570f9ec8b7">fsat7Create</a>(0, 0);</div>
<div class="line">        <span class="keywordflow">if</span> (t7) {</div>
<div class="line">                <span class="keywordtype">int</span> c, columns = <a class="code" href="group__fsat7.html#gafe9517db10955916045b1350e8ef33a5">fsat7GetColumnCount</a>(t7);</div>
<div class="line">                <span class="keywordtype">int</span> r, rows = <a class="code" href="group__fsat7.html#ga36ae9fda1ce444be33b82260bbe39ee0">fsat7GetRowCount</a>(t7);</div>
<div class="line">                <span class="keywordtype">float</span>* values = malloc(columns * rows * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div>
<div class="line">                <span class="keywordflow">if</span> (values) {</div>
<div class="line">                        <span class="keywordtype">float</span> minimum, maximum;</div>
<div class="line">                        <span class="keywordtype">char</span> units[32];</div>
<div class="line">                        <span class="keywordflow">if</span> (<a class="code" href="group__fsat7.html#ga3e33173521bfdbb159f9527f6ec5ac2e">fsat7LoadCalibration</a>(t7)) {</div>
<div class="line">                                minimum = <a class="code" href="group__fsat7.html#gab2e6f6b3e3bbea46e0bd847fd39e6245">fsat7GetMinimum</a>(t7);</div>
<div class="line">                                maximum = <a class="code" href="group__fsat7.html#gad687a9b5c4009faa45f79e174a3576d6">fsat7GetMaximum</a>(t7);</div>
<div class="line">                                <a class="code" href="group__fsat7.html#gaaf69ff7b5ff6d799515f3e508166d9e5">fsat7GetUnits</a>(t7, units);</div>
<div class="line">                        }</div>
<div class="line">                        <span class="keywordflow">else</span> {</div>
<div class="line">                                minimum = 0;</div>
<div class="line">                                maximum = <a class="code" href="group__fsat7.html#gab5e8c89fab9e25ddc2c20f6cebac9bea">fsat7GetConductance</a>(t7);</div>
<div class="line">                                strcpy(units, <span class="stringliteral">&quot;uSiemens&quot;</span>);</div>
<div class="line">                        }</div>
<div class="line">                        printf(<span class="stringliteral">&quot;%dx%d  %f-%f %s\r\n&quot;</span>, columns, rows, minimum, maximum, units);</div>
<div class="line">                        <span class="keywordflow">if</span> (<a class="code" href="group__fsat7.html#gaf614588459895420a2f841ea81316f2e">fsat7Scan</a>(t7, values, NULL)) {</div>
<div class="line">                                <span class="keywordtype">float</span>* value = values;</div>
<div class="line">                                <span class="keywordflow">for</span> (r = 0; r &lt; rows; ++r) {</div>
<div class="line">                                        <span class="keywordflow">for</span> (c = 0; c &lt; columns; ++c, ++value) printf(<span class="stringliteral">&quot;%4d&quot;</span>, (<span class="keywordtype">int</span>)(*value));</div>
<div class="line">                                        puts(<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">                                }</div>
<div class="line">                        }</div>
<div class="line">                        <span class="keywordflow">else</span> puts(<span class="stringliteral">&quot;Failed to scan sensor array.&quot;</span>);</div>
<div class="line">                        free(values);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span> puts(<span class="stringliteral">&quot;Failed to allocate value buffer.&quot;</span>);</div>
<div class="line">                <a class="code" href="group__fsat7.html#ga5653b2d4a997b751107aef14536aa856">fsat7Destroy</a>(t7);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> puts(<span class="stringliteral">&quot;Failed to connect to a sensor array.&quot;</span>);</div>
<div class="line">        fsat7Uninitialize();</div>
<div class="line">}</div>
</div><!-- fragment --><p>This example starts out by creating an instance of the FSAT7 class.</p>
<p><div class="fragment"><div class="line">        t7 = <a class="code" href="group__fsat7.html#ga53b517f891e779676eeb26570f9ec8b7">fsat7Create</a>(0, 0);</div>
</div><!-- fragment --></p>
<p>The first parameter (0) indicates that we're interested in any T7 that is connected to the computer (as opposed to a specific T7). The second parameter (0) indicates that we don't want the calibration data to be automatically downloaded upon connection. In this example we'll retreive the calibration data in a separate step. After successfully creating the FSAT7 object we get some basic information about the mat. First we get the number of rows and columns of sensors in the mat.</p>
<p><div class="fragment"><div class="line">                <span class="keywordtype">int</span> c, columns = <a class="code" href="group__fsat7.html#gafe9517db10955916045b1350e8ef33a5">fsat7GetColumnCount</a>(t7);</div>
<div class="line">                <span class="keywordtype">int</span> r, rows = <a class="code" href="group__fsat7.html#ga36ae9fda1ce444be33b82260bbe39ee0">fsat7GetRowCount</a>(t7);</div>
</div><!-- fragment --></p>
<p>The parameter t7 is a reference to the FSAT7 object; this parameter is required by all fsat7 functions.</p>
<p>When the mat is scanned it returns a floating point value for each sensor in the mat. The number of sensors in the mat is equal to the number of columns times the number of rows. We need to create a buffer large enough to hold that many floating-point values.</p>
<p><div class="fragment"><div class="line">                <span class="keywordtype">float</span>* values = malloc(columns * rows * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div>
</div><!-- fragment --></p>
<p>Once we have succesfully allocated the buffer we can take readings from the mat, but first we'll attempt to retrieve calibration data from the mat.</p>
<p><div class="fragment"><div class="line">                        <span class="keywordflow">if</span> (<a class="code" href="group__fsat7.html#ga3e33173521bfdbb159f9527f6ec5ac2e">fsat7LoadCalibration</a>(t7)) {</div>
</div><!-- fragment --></p>
<p>If successful, we'll get the pressure range that the mat is calibrated over.</p>
<p><div class="fragment"><div class="line">                                minimum = <a class="code" href="group__fsat7.html#gab2e6f6b3e3bbea46e0bd847fd39e6245">fsat7GetMinimum</a>(t7);</div>
<div class="line">                                maximum = <a class="code" href="group__fsat7.html#gad687a9b5c4009faa45f79e174a3576d6">fsat7GetMaximum</a>(t7);</div>
<div class="line">                                <a class="code" href="group__fsat7.html#gaaf69ff7b5ff6d799515f3e508166d9e5">fsat7GetUnits</a>(t7, units);</div>
</div><!-- fragment --></p>
<p>If there's no calibration data then readings from the mat will be conductance values (microSiemens). We can get the range of expected conductance values like so:</p>
<p><div class="fragment"><div class="line">                                minimum = 0;</div>
<div class="line">                                maximum = <a class="code" href="group__fsat7.html#gab5e8c89fab9e25ddc2c20f6cebac9bea">fsat7GetConductance</a>(t7);</div>
<div class="line">                                strcpy(units, <span class="stringliteral">&quot;uSiemens&quot;</span>);</div>
</div><!-- fragment --></p>
<p>Now that we know the range of values that we can expect we'll take a reading from the mat.</p>
<p><div class="fragment"><div class="line">                        <span class="keywordflow">if</span> (<a class="code" href="group__fsat7.html#gaf614588459895420a2f841ea81316f2e">fsat7Scan</a>(t7, values, NULL)) {</div>
</div><!-- fragment --></p>
<p>You'll notice we've passed the function a pointer to the buffer we allocated earlier. The NULL in the third parameter indicates that we're not interested in any additional information about the reading. See the fsat7Scan documentation for more information.</p>
<p>If successful, the buffer is filled with sensor readings. The readings are in order from left to right, top to bottom. To illustrate how the sensor readings can be processed, the example loops through all the rows and columns of sensors and prints their value.</p>
<p><div class="fragment"><div class="line">                                <span class="keywordflow">for</span> (r = 0; r &lt; rows; ++r) {</div>
<div class="line">                                        <span class="keywordflow">for</span> (c = 0; c &lt; columns; ++c, ++value) printf(<span class="stringliteral">&quot;%4d&quot;</span>, (<span class="keywordtype">int</span>)(*value));</div>
<div class="line">                                        puts(<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">                                }</div>
</div><!-- fragment --></p>
<p>Had we wanted to, we could have called fsat7Scan repeatedly; no need to call fsat7Create again.</p>
<p>The remainder of the example handles clean-up and errors. Most importantly:</p>
<p><div class="fragment"><div class="line">                <a class="code" href="group__fsat7.html#ga5653b2d4a997b751107aef14536aa856">fsat7Destroy</a>(t7);</div>
</div><!-- fragment --></p>
<p>This statement frees up any resource used by the FSAT7 object.</p>
<p>The above example can be found in the FSA SDK in the example folder. That folder also contains an nmakefile that can be used to compile the example under Windows (provided you have nmake) as well as a makefile for compiling on Linux.</p>
<p>On Windows, open a command prompt and change the current directory to the example directory, and type the following command:</p>
<p><code>nmake</code> <code>-fnmakefile</code> </p>
<p>Provided your build environment is configured correctly this command should produce an executable file called fsascan.exe. To test it connect a T7 mat and run the executable.</p>
<p>On Linux, open a terminal and change the current directory to the example directory, and type the following command:</p>
<p><code>make</code> </p>
<p>Provided your build environment is configured correctly this command should produce an executable file called fsascan. To test it connect a T7 mat and run the executable. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Jan 19 2015 14:14:53 for FSACLibrary by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
